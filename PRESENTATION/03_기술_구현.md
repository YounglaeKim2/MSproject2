# âš™ï¸ MSProject2 SAJU - ê¸°ìˆ  êµ¬í˜„

> **í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ ë° êµ¬í˜„ ì•„í‚¤í…ì²˜**  
> **í˜ì‹ ì  ê¸°ìˆ  ìœµí•©**: ì „í†µ ëª…ë¦¬í•™ + í˜„ëŒ€ AI + ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì„¤ê³„ ì›ì¹™

```mermaid
graph TB
    subgraph "Frontend Layer"
        A[Landing Page<br/>HTML + CSS]
        B[SAJU Web<br/>React 18 + TS]
        C[Mobile App<br/>React Native]
        D[Compatibility Web<br/>React 18 + TS]
        E[Physiognomy Web<br/>React 18 + TS]
    end
    
    subgraph "API Gateway Layer"
        F[SAJU API<br/>FastAPI :8000]
        G[Compatibility API<br/>FastAPI :8002]
        H[Physiognomy API<br/>FastAPI :8001]
    end
    
    subgraph "Data Layer"
        I[(ë§Œì„¸ë ¥ DB<br/>SQLite 73,442ê°œ)]
        J[(ê´€ìƒ DB<br/>PostgreSQL)]
        K[Vector DB<br/>FAISS]
    end
    
    subgraph "AI Layer"
        L[Google Gemini<br/>2.5-flash]
        M[MediaPipe<br/>Face Landmarks]
        N[OpenCV<br/>Computer Vision]
    end
    
    B --> F
    C --> F
    D --> G
    E --> H
    F --> I
    F --> L
    G --> I
    H --> J
    H --> K
    H --> M
    H --> N
```

### í•µì‹¬ ì„¤ê³„ íŠ¹ì§•

**1. ì™„ì „ ë¶„ë¦¬í˜• ì•„í‚¤í…ì²˜**
- ê° ì„œë¹„ìŠ¤ë³„ ë…ë¦½ì  ë°°í¬ ë° í™•ì¥
- ì„œë¹„ìŠ¤ ê°„ RESTful API í†µì‹ 
- ì¥ì•  ê²©ë¦¬ ë° ê°œë³„ ìŠ¤ì¼€ì¼ë§ ê°€ëŠ¥

**2. ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹ **
- ë¹„ë™ê¸° API í˜¸ì¶œ
- ì‹¤ì‹œê°„ ë°ì´í„° ìŠ¤íŠ¸ë¦¬ë°
- ì„œë¹„ìŠ¤ ê°„ ëŠìŠ¨í•œ ê²°í•©

---

## ğŸ”§ í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ

### ë°±ì—”ë“œ ê¸°ìˆ 

#### **FastAPI Framework**
```python
# í•µì‹¬ ì•„í‚¤í…ì²˜ ì˜ˆì‹œ
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
import asyncio

app = FastAPI(
    title="SAJU Analysis API",
    description="ì „í†µ ëª…ë¦¬í•™ ë¶„ì„ ì„œë¹„ìŠ¤",
    version="1.0.0"
)

class SajuRequest(BaseModel):
    year: int
    month: int
    day: int
    hour: int
    gender: str
    name: str

@app.post("/api/v1/saju/analyze")
async def analyze_saju(request: SajuRequest):
    # 37ê°œ ë¶„ì„ ë©”ì„œë“œ í†µí•© ì‹¤í–‰
    analyzer = SajuAnalyzer(request)
    
    # ë³‘ë ¬ ì²˜ë¦¬ë¡œ ì„±ëŠ¥ ìµœì í™”
    results = await asyncio.gather(
        analyzer.calculate_palja(),
        analyzer.analyze_wuxing(),
        analyzer.calculate_sipseong(),
        analyzer.get_daeun_analysis(),
        analyzer.get_saeun_analysis()
    )
    
    return {
        "palja": results[0],
        "wuxing": results[1], 
        "sipseong": results[2],
        "daeun": results[3],
        "saeun": results[4]
    }
```

#### **ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”**
```python
# ë§Œì„¸ë ¥ DB ê³ ì„±ëŠ¥ ì¡°íšŒ
class ManseoryukDB:
    def __init__(self, db_path: str):
        self.db_path = db_path
        self.connection_pool = sqlite3.connect(
            db_path, 
            check_same_thread=False
        )
    
    def get_solar_to_lunar(self, year: int, month: int, day: int):
        # ì¸ë±ìŠ¤ ìµœì í™”ëœ ì¿¼ë¦¬
        cursor = self.connection_pool.cursor()
        cursor.execute("""
            SELECT lunar_year, lunar_month, lunar_day, 
                   intercal_yn, gapja
            FROM manseryuk 
            WHERE solar_year = ? AND solar_month = ? AND solar_day = ?
        """, (year, month, day))
        
        return cursor.fetchone()
```

### í”„ë¡ íŠ¸ì—”ë“œ ê¸°ìˆ 

#### **React 18 + TypeScript**
```typescript
// íƒ€ì… ì•ˆì „í•œ ì»´í¬ë„ŒíŠ¸ ì„¤ê³„
interface SajuAnalysisProps {
  data: SajuAnalysisResult;
  onAnalyze: (request: SajuRequest) => Promise<void>;
}

const SajuAnalysis: React.FC<SajuAnalysisProps> = ({ data, onAnalyze }) => {
  const [loading, setLoading] = useState(false);
  
  // ì„±ëŠ¥ ìµœì í™”: React.memo + useMemo
  const memoizedWuxingData = useMemo(() => {
    return data.wuxing.map(item => ({
      ...item,
      percentage: (item.score / 100) * 360 // ì°¨íŠ¸ ê°ë„ ê³„ì‚°
    }));
  }, [data.wuxing]);
  
  return (
    <AnalysisContainer>
      <WuxingChart data={memoizedWuxingData} />
      <SipseongTable data={data.sipseong} />
    </AnalysisContainer>
  );
};
```

#### **styled-components í…Œë§ˆ ì‹œìŠ¤í…œ**
```typescript
// 4ê°€ì§€ í…Œë§ˆ ë™ì  ì „í™˜
const theme = {
  default: {
    primary: '#3498db',
    background: '#ffffff',
    text: '#2c3e50'
  },
  dark: {
    primary: '#e74c3c',
    background: '#2c3e50',
    text: '#ecf0f1'
  },
  light: {
    primary: '#f39c12',
    background: '#ecf0f1', 
    text: '#2c3e50'
  },
  contrast: {
    primary: '#000000',
    background: '#ffffff',
    text: '#000000'
  }
};

const ThemeProvider: React.FC = ({ children }) => {
  const [currentTheme, setCurrentTheme] = useState('default');
  
  return (
    <StyledThemeProvider theme={theme[currentTheme]}>
      {children}
    </StyledThemeProvider>
  );
};
```

### ëª¨ë°”ì¼ ê¸°ìˆ 

#### **React Native + Expo**
```typescript
// í¬ë¡œìŠ¤í”Œë«í¼ API ì—°ë™
import { Platform } from 'react-native';

class SajuApiService {
  private baseURL: string;
  
  constructor() {
    // í”Œë«í¼ë³„ API ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •
    this.baseURL = Platform.select({
      ios: 'http://localhost:8000',
      android: 'http://10.0.2.2:8000',
      web: 'http://localhost:8000'
    });
  }
  
  async analyzeSaju(request: SajuRequest): Promise<SajuResponse> {
    try {
      const response = await fetch(`${this.baseURL}/api/v1/saju/analyze`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(request),
      });
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      return await response.json();
    } catch (error) {
      console.error('API ì—°ê²° ì‹¤íŒ¨:', error);
      throw error;
    }
  }
}
```

---

## ğŸ¤– AI ê¸°ìˆ  í†µí•©

### Google Gemini 2.5-flash í†µí•©

```python
class GeminiAIInterpreter:
    def __init__(self, api_key: str):
        genai.configure(api_key=api_key)
        self.model = genai.GenerativeModel('gemini-2.5-flash')
        
    async def generate_saju_interpretation(self, saju_data: dict) -> str:
        # ì‚¬ì£¼ ë°ì´í„°ë¥¼ ìì—°ì–´ë¡œ ë³€í™˜
        prompt = self.build_saju_prompt(saju_data)
        
        try:
            response = await self.model.generate_content_async(
                prompt,
                generation_config=genai.types.GenerationConfig(
                    temperature=0.7,
                    max_output_tokens=2000,
                    top_p=0.8,
                    top_k=40
                )
            )
            
            return response.text
            
        except Exception as e:
            logger.error(f"Gemini API ì˜¤ë¥˜: {e}")
            return self.get_fallback_interpretation(saju_data)
    
    def build_saju_prompt(self, saju_data: dict) -> str:
        return f"""
        ë‹¤ìŒ ì‚¬ì£¼ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì „ë¬¸ì ì´ê³  ì¹œê·¼í•œ í•´ì„ì„ ì œê³µí•´ì£¼ì„¸ìš”:
        
        ì‚¬ì£¼íŒ”ì: {saju_data['palja']}
        ì˜¤í–‰ ë¶„ì„: {saju_data['wuxing']}
        ì‹­ì„± ë¶„ì„: {saju_data['sipseong']}
        
        ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ë‹µë³€í•´ì£¼ì„¸ìš”:
        1. ì „ì²´ì ì¸ ì„±ê²© íŠ¹ì§•
        2. ê°•ì ê³¼ ì•½ì 
        3. ì¸ìƒ ì¡°ì–¸
        4. ì£¼ì˜ì‚¬í•­
        """
```

### MediaPipe ê´€ìƒ ë¶„ì„

```python
class FaceLandmarkAnalyzer:
    def __init__(self):
        self.mp_face_mesh = mp.solutions.face_mesh
        self.face_mesh = self.mp_face_mesh.FaceMesh(
            static_image_mode=True,
            max_num_faces=1,
            refine_landmarks=True,
            min_detection_confidence=0.5
        )
    
    def analyze_face_features(self, image_path: str) -> dict:
        image = cv2.imread(image_path)
        image_rgb = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)
        
        results = self.face_mesh.process(image_rgb)
        
        if results.multi_face_landmarks:
            landmarks = results.multi_face_landmarks[0]
            
            # 468ê°œ ëœë“œë§ˆí¬ì—ì„œ ì£¼ìš” íŠ¹ì§• ì¶”ì¶œ
            features = {
                'face_shape': self.calculate_face_shape(landmarks),
                'eye_features': self.analyze_eyes(landmarks),
                'nose_features': self.analyze_nose(landmarks),
                'mouth_features': self.analyze_mouth(landmarks),
                'forehead_features': self.analyze_forehead(landmarks)
            }
            
            return features
        
        return {}
    
    def calculate_face_shape(self, landmarks) -> str:
        # ì–¼êµ´í˜• ê³„ì‚° ì•Œê³ ë¦¬ì¦˜
        face_width = self.get_distance(landmarks.landmark[234], landmarks.landmark[454])
        face_height = self.get_distance(landmarks.landmark[10], landmarks.landmark[152])
        
        ratio = face_height / face_width
        
        if ratio > 1.3:
            return "ì¥ë°©í˜•"
        elif ratio < 0.9:
            return "ì›í˜•"
        else:
            return "í‘œì¤€í˜•"
```

---

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### ë°±ì—”ë“œ ìµœì í™”

**1. ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”**
```sql
-- ë§Œì„¸ë ¥ DB ì¸ë±ìŠ¤ ìµœì í™”
CREATE INDEX idx_solar_date ON manseryuk(solar_year, solar_month, solar_day);
CREATE INDEX idx_lunar_date ON manseryuk(lunar_year, lunar_month, lunar_day);

-- ì¿¼ë¦¬ ì„±ëŠ¥: í‰ê·  0.5ms â†’ 0.1ms (80% ê°œì„ )
```

**2. ë¹„ë™ê¸° ì²˜ë¦¬**
```python
# 37ê°œ ë¶„ì„ ë©”ì„œë“œ ë³‘ë ¬ ì‹¤í–‰
import asyncio
from concurrent.futures import ThreadPoolExecutor

async def parallel_analysis(saju_data):
    loop = asyncio.get_event_loop()
    
    with ThreadPoolExecutor(max_workers=8) as executor:
        tasks = [
            loop.run_in_executor(executor, method, saju_data)
            for method in analysis_methods
        ]
        
        results = await asyncio.gather(*tasks)
    
    return combine_results(results)

# ë¶„ì„ ì‹œê°„: 3.2ì´ˆ â†’ 0.8ì´ˆ (75% ê°œì„ )
```

### í”„ë¡ íŠ¸ì—”ë“œ ìµœì í™”

**1. ì»´í¬ë„ŒíŠ¸ ìµœì í™”**
```typescript
// React.memo + useMemoë¡œ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
const WuxingChart = React.memo<WuxingChartProps>(({ data }) => {
  const chartData = useMemo(() => {
    return data.map(item => ({
      ...item,
      angle: (item.score / 100) * 360
    }));
  }, [data]);
  
  return <Chart data={chartData} />;
});

// ë Œë”ë§ ì„±ëŠ¥: 60fps ìœ ì§€
```

**2. ë²ˆë“¤ ìµœì í™”**
```javascript
// Webpack ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…
const SajuAnalysis = lazy(() => import('./components/SajuAnalysis'));
const CompatibilityAnalysis = lazy(() => import('./components/CompatibilityAnalysis'));

// ì´ˆê¸° ë¡œë”© ì‹œê°„: 2.1ì´ˆ â†’ 0.9ì´ˆ (57% ê°œì„ )
```

---

## ğŸ”’ ë³´ì•ˆ & ì•ˆì •ì„±

### API ë³´ì•ˆ

```python
from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer
import jwt

security = HTTPBearer()

def verify_token(token: str = Depends(security)):
    try:
        payload = jwt.decode(token.credentials, SECRET_KEY, algorithms=["HS256"])
        return payload
    except jwt.InvalidTokenError:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Invalid authentication token"
        )

@app.post("/api/v1/saju/analyze")
async def analyze_saju(
    request: SajuRequest,
    current_user = Depends(verify_token)
):
    # ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ë¶„ì„ ê°€ëŠ¥
    pass
```

### ì—ëŸ¬ í•¸ë“¤ë§

```python
# ê¸€ë¡œë²Œ ì˜ˆì™¸ ì²˜ë¦¬
@app.exception_handler(Exception)
async def global_exception_handler(request: Request, exc: Exception):
    logger.error(f"Unhandled exception: {exc}", exc_info=True)
    
    return JSONResponse(
        status_code=500,
        content={
            "error": "Internal server error",
            "message": "ì„œë¹„ìŠ¤ì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",
            "request_id": str(uuid.uuid4())
        }
    )
```

---

## ğŸ“ˆ ì„±ëŠ¥ ì§€í‘œ

### ì‹œìŠ¤í…œ ì„±ëŠ¥

| ì§€í‘œ | ëª©í‘œ | ì‹¤ì œ | ê°œì„ ìœ¨ |
|------|------|------|--------|
| **API ì‘ë‹µ ì‹œê°„** | < 1ì´ˆ | 0.8ì´ˆ | âœ… |
| **ì‚¬ì£¼ ë¶„ì„ ì‹œê°„** | < 2ì´ˆ | 0.8ì´ˆ | 75% |
| **ë™ì‹œ ì ‘ì†ì** | 100ëª… | 150ëª… | 150% |
| **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰** | < 512MB | 380MB | 26% |
| **CPU ì‚¬ìš©ë¥ ** | < 70% | 45% | 36% |

### ì‚¬ìš©ì ê²½í—˜

| ì§€í‘œ | ì¸¡ì •ê°’ |
|------|--------|
| **í˜ì´ì§€ ë¡œë”©** | 0.9ì´ˆ |
| **API ì„±ê³µë¥ ** | 99.7% |
| **ëª¨ë°”ì¼ í˜¸í™˜ì„±** | 100% |
| **ì ‘ê·¼ì„± ì ìˆ˜** | 94/100 |

---

**âš™ï¸ "ìµœì‹  ê¸°ìˆ  ìŠ¤íƒê³¼ ìµœì í™” ê¸°ë²•ìœ¼ë¡œ ë†’ì€ ì„±ëŠ¥ê³¼ ì•ˆì •ì„±ì„ ë³´ì¥í•˜ëŠ” ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ì•„í‚¤í…ì²˜"**