# 마이크로서비스 환경 실행 문제 해결

**📅 발생일**: 2025-07-31 14:30
**📅 해결일**: 2025-07-31 15:00
**⏱️ 소요시간**: 30분

---

## 🔍 문제 상황

- `main-app` 실행 후 `SAJU` 페이지에 접속했지만, 기능이 정상적으로 동작하지 않았습니다.
- `http://localhost:3000/`으로 직접 접속 시에도 페이지가 열리지 않았습니다.

## 🎯 원인 분석

1.  **마이크로서비스 아키텍처 이해 부족**: `main-app`이 모든 서비스를 포함하여 실행하는 단일 애플리케이션(Monolithic)이라고 오해했습니다. 실제로는 각 서비스가 독립적으로 실행되어야 하는 마이크로서비스 구조였습니다.
2.  **개별 서비스 미실행**: `SAJU` 서비스의 백엔드(API 서버)와 프론트엔드(UI 서버)가 각각 실행되지 않은 상태였습니다.
3.  **잘못된 실행 위치**: `uvicorn`으로 SAJU 백엔드를 실행할 때, `SAJU` 프로젝트의 루트 폴더가 아닌 `SAJU/backend` 폴더에서 실행해야 `app` 모듈을 정상적으로 찾을 수 있었습니다.

## 🔧 해결 과정

각 서비스를 개별 터미널에서 올바른 순서와 경로로 실행하여 문제를 해결했습니다.

1.  **`main-app` 프론트엔드 실행 (포트 4000)**
    ```bash
    cd C:\Project_Final\MSproject2\main-app
    npm install
    npm start
    ```

2.  **`SAJU` 백엔드 API 실행 (포트 8000)**
    ```bash
    cd C:\Project_Final\MSproject2\SAJU\backend
    pip install -r requirements.txt
    uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
    ```

3.  **`SAJU` 프론트엔드 UI 실행 (포트 3000)**
    ```bash
    cd C:\Project_Final\MSproject2\SAJU\frontend
    npm install
    npm start
    ```

## ✅ 결과 및 교훈

- 모든 서비스(`main-app`, `SAJU` 백엔드, `SAJU` 프론트엔드)가 각자의 포트에서 정상적으로 실행되었습니다.
- `main-app`을 통해 다른 서비스들(`SAJU` 등)에 접근하고, 해당 기능들이 원활하게 동작하는 것을 확인했습니다.
- 마이크로서비스 아키텍처에서는 각 컴포넌트(서비스)를 독립적으로 실행하고 관리해야 한다는 점을 명확히 이해하게 되었습니다.

---

# Physiognomy 서비스 기능 확장 및 코드 수정

**📅 작업일**: 2025-07-31

## 📝 작업 내용

- **목표**: 기존 관상 서비스의 분석 정확도와 상세함을 높이기 위해, 분석 가능한 관상 특징 대폭 추가.
- **수정 파일**:
    1.  `Physiognomy/backend/app/services/geometry_calculator.py`
    2.  `Physiognomy/backend/app/services/rule_engine.py`
    3.  `Physiognomy/backend/app/services/report_generator.py`

## ✨ 상세 변경 사항

1.  **`geometry_calculator.py` 수정**:
    - **랜드마크 인덱스 추가**: 얼굴형, 눈썹, 턱, 인중 등 더 세밀한 특징 계산을 위해 필요한 MediaPipe 랜드마크 인덱스 추가.
    - **계산 로직 확장**: 기존의 단순한 비율 계산을 넘어, 얼굴 너비 대비 광대 너비, 턱 너비, M자 이마 굴곡, 눈썹 모양, 코끝 뾰족함, 들창코 여부, 주걱턱/무턱 판단 등 수십 개의 새로운 기하학적 특징 계산 로직 추가.

2.  **`rule_engine.py` 수정**:
    - **규칙 확장**: `geometry_calculator.py`에서 새로 계산된 측정값들을 기반으로, 사용자가 요청한 모든 세부 관상 규칙(예: 사각형 얼굴형, M자 이마, 초승달 눈썹, V라인 턱 등)을 판단하는 조건문(if-else) 로직 추가.
    - **결과 정제**: 다양한 규칙이 중복 적용될 수 있어, 최종 해석 키 리스트에서 중복을 제거하여 반환하도록 수정.

3.  **`report_generator.py` 수정**:
    - **해석 키-값 매핑 업데이트**: 새로 추가된 모든 관상 특징 키(예: `FACE_SHAPE_SQUARE`, `EYEBROWS_LONG`)와 그에 해당하는 한글 설명(예: "사각형 얼굴형", "긴 눈썹")을 `KEY_TO_FEATURE_MAP` 딕셔너리에 추가.
    - **AI 리포트 생성 강화**: 확장된 특징들을 기반으로 AI가 더 풍부하고 상세한 종합 관상 리포트를 생성할 수 있도록 시스템 기반 마련.

## ✅ 결과

- 관상 분석 서비스가 기존보다 훨씬 더 상세하고 다양한 특징(얼굴형, 이마, 눈, 코, 입, 턱 등)을 인식하고 분석할 수 있게 됨.
- 코드 수정 후, `docker-compose.yml`의 `--reload` 옵션 덕분에 별도의 재시작 없이 변경 사항이 실행 중인 서비스에 자동 반영됨을 확인함.
